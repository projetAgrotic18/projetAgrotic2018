<?php /*session_start();
if (isset($_SESSION["id_compte"])==false){
    header("Location: http://194.199.251.68/projetAgrotic2018/page d'accueil/Connexion.php");
    exit;
}*/?>
<html>
    <head>
        <title>Liste des exploitations</title>
		<META charset="UTF-8"/>
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
         		
		<!--- Style Sonnaille -->
        <link href="../general/front/style.css" rel="stylesheet">
        
		<!--Deux lignes de code pour le tableau-->
		<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css"/>
		<script type="text/javascript" src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
		
         <!-- Section Javascript : définition de la fonction gérant l'affichage de l'annuaire -->
		<script type="text/javascript">
			//Code pour la mise en forme du tableau (voir datatable)
			$(document).ready(function() {
				$('#example').DataTable();
			});
		</script>
    </head>
    <body>
    	<!-- Entête -->
    
    	<!-- DIV Navigation (Menus) -->
        <?php include("../general/front/navigation.html"); ?>
    
    	<!-- Appelle de la page regroupant les fonctions -->
        <?php require_once('../general/procedures.php'); ?>
		
		<div class="padding">
			<h2>Liste des exploitations</h2>
			
				<?php
			
				//Appel du fichier contenant la fonction de connexion
				require ("../general/connexionPostgreSQL.class.php");
            		
        		// Connexion, sélection de la base de données du projet
        		$connex = new connexionPostgreSQL();
				
				$result_all_exp =  $connex->requete("SELECT cu.nom AS 'Nom', v.nom_exploitation AS 'Exploitation', v.adresse, v.nom_commune, v.code_postal, v.libelle_dep, v.id_visite, v.date_visite FROM v_liste_exploit_proph v JOIN compte_utilisateur cu ON v.id_compte=cu.id_compte");
				
				$nbr_col = pg_num_fields($result_all_exp);
				?>
				
				<TABLE border=1 id="example">
					<THEAD>
						<TR>
							<?php
							for($i = 0; $i < $nbr_col; $i++) {
								$nom_champ = pg_field_name($result_all_exp, $i);
								echo ("<TH>" . $nom_champ. "</TH>");
							}
							?>
						</TR>
					</THEAD>
					<TBODY>
						<?php
						while ($row = pg_fetch_array($result_all_exp)){
							echo "<TR>";
								for ($i=0; $i<$nbr_col; $i++){
									echo "<td>".$row[$i]."</td>";
								}
							echo "</TR>";
						}
						?>
					</TBODY>
				</TABLE>
			<BR/>		
			<input type="button" value="Retour" onclick="self.history.back()">
		</div>
    
		 <!-- Pied de page -->		
        <?php include("../general/front/footer.html"); ?>	
		
	</body>
</html>